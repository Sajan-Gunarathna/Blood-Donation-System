<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LifeLine Admin Dashboard</title>
    <style>
        :root{
            /* Red + White theme */
            --bg:#ffffff;            /* page background */
            --card:#ffffff;          /* surfaces */
            --muted:#e9edf4;         /* borders / separators */
            --text:#1a1c24;          /* main text */
            --sub:#5b6478;           /* secondary text */
            --primary:#e11d48;       /* red 600 */
            --primary-600:#be123c;   /* red 700 */
            --accent:#f43f5e;        /* bright red */
            --success:#16a34a;       /* green */
            --warning:#f59e0b;
        }
        *{box-sizing:border-box}
        html,body{height:100%}
        body{margin:0;background:var(--bg);color:var(--text);font:14px/1.4 Inter,Segoe UI,Arial,sans-serif}

        .layout{display:grid;grid-template-columns:240px 1fr;min-height:100vh}
        .sidebar{background:#ffffff;border-right:1px solid var(--muted);padding:16px;display:flex;flex-direction:column;gap:16px;position:sticky;top:0;height:100vh}
        .brand{font-weight:800;font-size:18px;letter-spacing:.5px;color:var(--primary)}
        .sidebar nav{display:flex;flex-direction:column;gap:8px}
        .sidebar nav a{padding:10px 12px;border-radius:10px;color:var(--sub);text-decoration:none}
        .sidebar nav a.active,.sidebar nav a:hover{background:rgba(225,29,72,0.08);color:var(--primary)}
        .sidebar-footer{margin-top:auto;color:var(--sub);font-size:12px}

        .content{padding:20px 24px;}
        .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
        .topbar .search{background:#fff;border:1px solid var(--muted);color:var(--text);padding:8px 10px;border-radius:10px;min-width:220px}
        .btn{border:1px solid var(--muted);background:#fff;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
        .btn.primary{background:var(--primary);border-color:var(--primary-600);color:#fff}
        .btn.ghost{background:transparent}

        .cards{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:14px;margin-bottom:18px}
        .card{background:#fff;border:1px solid var(--muted);border-radius:16px;padding:14px;box-shadow:0 2px 10px rgba(30,41,59,0.04)}
        .metric{display:flex;align-items:center;gap:12px}
        .metric .icon{width:40px;height:40px;border-radius:12px;display:grid;place-items:center;font-weight:800;color:var(--primary)}
        .metric .icon.red{background:rgba(225,29,72,0.1);border:1px solid rgba(225,29,72,0.25)}
        .metric .icon.orange{background:rgba(244,63,94,0.08);border:1px solid rgba(244,63,94,0.2)}
        .metric .icon.purple{background:rgba(244,63,94,0.08);border:1px solid rgba(244,63,94,0.18)}
        .metric .icon.green{background:rgba(22,163,74,0.08);border:1px solid rgba(22,163,74,0.22);color:#15803d}
        .metric-body{display:flex;flex-direction:column}
        .metric-title{color:var(--sub);font-size:12px}
        .metric-value{font-size:22px;font-weight:800}

        .panel{background:#fff;border:1px solid var(--muted);border-radius:16px;margin-bottom:16px;box-shadow:0 2px 10px rgba(30,41,59,0.04)}
        .panel-head{display:flex;justify-content:space-between;align-items:center;padding:14px;border-bottom:1px solid var(--muted)}
        .inline-form{display:flex;gap:8px;flex-wrap:wrap}
        input,select{background:#fff;border:1px solid var(--muted);color:var(--text);padding:8px 10px;border-radius:10px}
        .switch{display:flex;align-items:center;gap:6px;color:var(--sub)}
        .table-wrap{overflow:auto}
        .table{width:100%;border-collapse:collapse}
        .table th,.table td{padding:10px 12px;border-bottom:1px solid var(--muted);text-align:left}
        .table thead th{color:var(--sub);font-weight:600;font-size:12px}
        .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}

        .hidden{display:none}
        
        /* Status badges */
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .status-badge.available { background: rgba(22,163,74,0.1); color: #15803d; }
        .status-badge.used { background: rgba(244,63,94,0.1); color: #be123c; }
        .status-badge.expired { background: rgba(245,158,11,0.1); color: #d97706; }
        .status-badge.removed { background: rgba(107,114,128,0.1); color: #6b7280; }

        @media (max-width:1100px){.cards{grid-template-columns:repeat(2,1fr)}.grid-2{grid-template-columns:1fr}}
        @media (max-width:720px){.layout{grid-template-columns:1fr}.sidebar{position:static;height:auto;border-right:0;border-bottom:1px solid var(--muted)}.cards{grid-template-columns:1fr}}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script>
        async function fetchJSON(url, opts) {
            const res = await fetch(url, Object.assign({ headers: { 'Content-Type': 'application/json' } }, opts));
            if (!res.ok) throw new Error(await res.text());
            return res.json();
        }

        async function loadDashboard() {
            await Promise.all([
                loadInventory(),
                loadCampaigns(),
                loadUsers(),
            ]);
            highlightNav();
            routeTo(location.hash || '#dashboard');
        }

        let invChartRef = null;
        // New inventory management variables
        let bloodUnits = [];
        let filteredUnits = [];

        async function loadInventory() {
            try {
                const response = await fetch('/api/blood-units');
                if (!response.ok) throw new Error('Network error: ' + response.status);
                bloodUnits = await response.json();
                filteredUnits = [...bloodUnits];
                renderTable();
                updateSummaryCards();
            } catch (error) {
                console.error('Error loading blood units:', error);
                showAlert('Error loading blood units', 'danger');
            }
        }

        function renderTable() {
            const tbody = document.getElementById('inventoryTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = filteredUnits.map(unit => `
                <tr>
                    <td>${unit.id}</td>
                    <td>${unit.bloodType}</td>
                    <td>${unit.quantity}</td>
                    <td>${formatDate(unit.donationDate)}</td>
                    <td>${formatDate(unit.expiryDate)}</td>
                    <td><span class="status-badge ${unit.status.toLowerCase()}">${unit.status}</span></td>
                    <td>
                        <button onclick="editUnit('${unit.id}')" class="btn btn-sm" style="margin-right: 5px;">‚úèÔ∏è Adjust</button>
                        <button onclick="deleteUnit('${unit.id}')" class="btn btn-sm" style="background: #dc3545; color: white;">üóëÔ∏è Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function updateSummaryCards() {
            const total = bloodUnits.reduce((sum, unit) => sum + unit.quantity, 0);
            const available = bloodUnits.filter(u => u.status === 'Available').reduce((sum, unit) => sum + unit.quantity, 0);
            const used = bloodUnits.filter(u => u.status === 'Used').reduce((sum, unit) => sum + unit.quantity, 0);
            const expired = bloodUnits.filter(u => u.status === 'Expired' || u.status === 'Removed').reduce((sum, unit) => sum + unit.quantity, 0);

            document.getElementById('totalUnits').textContent = total;
            document.getElementById('availableUnits').textContent = available;
            document.getElementById('usedUnits').textContent = used;
            document.getElementById('expiredUnits').textContent = expired;

            // Update Dashboard KPIs for chart
            const sumGroup = (g) => bloodUnits
                .filter(x => x.bloodType.startsWith(g) && x.status === 'Available')
                .reduce((s,x) => s + (x.quantity||0), 0);
            document.getElementById('kpiA').textContent = sumGroup('A');
            document.getElementById('kpiB').textContent = sumGroup('B');
            document.getElementById('kpiAB').textContent = sumGroup('AB');
            document.getElementById('kpiO').textContent = sumGroup('O');

            // Build chart by exact type
            const labels = ['A+','A-','B+','B-','AB+','AB-','O+','O-'];
            const values = labels.map(t => (bloodUnits.find(x => x.bloodType===t && x.status === 'Available')?.quantity)||0);

            const ctx = document.getElementById('invChart');
            if (ctx) {
                if (invChartRef) { invChartRef.destroy(); }
                invChartRef = new Chart(ctx, {
                    type: 'bar',
                    data: { labels, datasets: [{
                            label: 'Units Available',
                            data: values,
                            backgroundColor: labels.map(()=>'rgba(225,29,72,0.3)'),
                            borderColor: labels.map(()=>'rgba(190,18,60,1)'),
                            borderWidth: 1,
                            borderRadius: 6,
                        }]},
                    options: { responsive: true, maintainAspectRatio: false,
                        scales: { y: { beginAtZero: true, ticks: { precision:0 } } },
                        plugins: { legend: { display: false } }
                    }
                });
            }
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            return new Date(dateString).toLocaleDateString();
        }

        function showAlert(message, type) {
            // Simple alert for now - you can enhance this with a proper notification system
            alert(message);
        }

        // Modal functions
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        // Search functionality
        function filterUnits() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            filteredUnits = bloodUnits.filter(unit => 
                unit.id.toLowerCase().includes(searchTerm) ||
                unit.bloodType.toLowerCase().includes(searchTerm) ||
                unit.status.toLowerCase().includes(searchTerm)
            );
            renderTable();
        }

        // CRUD operations
        async function recordDonation() {
            const form = document.getElementById('registerForm');
            const unitData = {
                id: document.getElementById('unitId').value,
                bloodType: document.getElementById('bloodType').value,
                quantity: parseInt(document.getElementById('quantity').value),
                donationDate: document.getElementById('donationDate').value,
                expiryDate: document.getElementById('expiryDate').value,
                status: 'Available'
            };

            try {
                const response = await fetch('/api/blood-units', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(unitData)
                });

                if (!response.ok) throw new Error('Failed to create unit');
                
                showAlert('Blood unit registered successfully!', 'success');
                closeModal('registerModal');
                form.reset();
                await loadInventory();
            } catch (error) {
                console.error('Error creating unit:', error);
                showAlert('Error creating blood unit', 'danger');
            }
        }

        function editUnit(unitId) {
            const unit = bloodUnits.find(u => u.id === unitId);
            if (!unit) return;

            document.getElementById('editUnitId').value = unit.id;
            document.getElementById('editBloodType').value = unit.bloodType;
            document.getElementById('editQuantity').value = unit.quantity;
            document.getElementById('editStatus').value = unit.status;
            
            openModal('editModal');
        }

        async function updateUnit() {
            const unitId = document.getElementById('editUnitId').value;
            const bloodType = document.getElementById('editBloodType').value;
            const quantityStr = document.getElementById('editQuantity').value;
            const status = document.getElementById('editStatus').value;

            const unitData = {};
            if (bloodType) unitData.bloodType = bloodType;
            if (quantityStr !== '') unitData.quantity = parseInt(quantityStr);
            if (status) unitData.status = status;

            try {
                const response = await fetch(`/api/blood-units/${unitId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(unitData)
                });

                if (!response.ok) throw new Error('Failed to update unit');
                
                showAlert('Blood unit updated successfully!', 'success');
                closeModal('editModal');
                await loadInventory();
            } catch (error) {
                console.error('Error updating unit:', error);
                showAlert('Error updating blood unit', 'danger');
            }
        }

        async function deleteUnit(unitId) {
            if (!confirm('Are you sure you want to delete this blood unit?')) return;

            try {
                const response = await fetch(`/api/blood-units/${unitId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('Failed to delete unit');
                
                showAlert('Blood unit deleted successfully!', 'success');
                await loadInventory();
            } catch (error) {
                console.error('Error deleting unit:', error);
                showAlert('Error deleting blood unit', 'danger');
            }
        }

        async function loadCampaigns() {
            const data = await fetchJSON('/api/admin/campaigns');
            const tbody = document.querySelector('#campaigns tbody');
            tbody.innerHTML = data.map(c => `<tr><td>${c.title}</td><td>${c.startDate||''}</td><td>${c.endDate||''}</td><td>${c.active}</td></tr>`).join('');
        }



        let selectedUserId = null;
        async function loadUsers() {
            try {
                const response = await fetch('/api/admin/users');
                if (!response.ok) throw new Error('Network error: ' + response.status);
                const data = await response.json();

                const tbody = document.querySelector('#users tbody');
                tbody.innerHTML = data.map(u => `
      <tr>
        <td>${u.username}</td>
        <td>${u.role}</td>
        <td>
          <button class="btn btn-sm btn-primary" onclick="onEditUser(${u.id})">Edit</button>
          <button class="btn btn-sm btn-danger" onclick="onDeleteUser(${u.id})">Delete</button>
        </td>
      </tr>
    `).join('');
            } catch (err) {
                console.error('Failed to load users:', err);
            }
        }

        document.addEventListener('DOMContentLoaded', loadUsers);


        function onEditUser(id){
            selectedUserId = id;
            fetchJSON('/api/admin/users/' + id).then(u => {
                const f = document.querySelector('#userForm');
                f.username.value = u.username;
                f.password.value = '';
                f.role.value = u.role;
                f.querySelector('[data-mode]').textContent = 'Update user';
            });
        }

        async function onDeleteUser(id){
            if(!confirm('Delete this user?')) return;
            await fetch('/api/admin/users/' + id, { method: 'DELETE' });
            if(selectedUserId === id) { selectedUserId = null; document.querySelector('#userForm').reset(); }
            loadUsers();
        }

        async function submitUser(e) {
            e.preventDefault();
            const f = e.target;
            const btn = f.querySelector('[data-mode]');
            btn.disabled = true;
            try {
                const payload = {
                    username: f.username.value,
                    password: f.password.value,
                    role: f.role.value
                };

                let res;
                if (selectedUserId) {
                    if (!payload.password) delete payload.password; // optional on update
                    res = await fetchJSON('/api/admin/users/' + selectedUserId, {
                        method: 'PUT',
                        body: JSON.stringify(payload)
                    });
                    alert('‚úÖ User updated successfully');
                } else {
                    if (!payload.password) {
                        alert('‚ö†Ô∏è Password is required to create a user.');
                        return;
                    }
                    res = await fetchJSON('/api/admin/users', {
                        method: 'POST',
                        body: JSON.stringify(payload)
                    });

                    // ‚úÖ Display backend success message if available
                    if (res && res.message) {
                        alert('‚úÖ ' + res.message);
                    } else {
                        alert('‚úÖ User created successfully');
                    }
                }

                f.reset();
                selectedUserId = null;
                btn.textContent = 'Create user';
                await loadUsers();

            } catch (err) {
                console.error(err);
                alert('‚ùå Failed to save user:\n' + err.message);
            } finally {
                btn.disabled = false;
            }
        }


        async function createCampaign(e) {
            e.preventDefault();
            const form = e.target;
            const payload = {
                title: form.title.value,
                description: form.description.value,
                startDate: form.startDate.value || null,
                endDate: form.endDate.value || null,
                active: form.active.checked
            };
            await fetchJSON('/api/admin/campaigns', { method: 'POST', body: JSON.stringify(payload) });
            form.reset();
            loadCampaigns();
        }



        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Search functionality
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', filterUnits);
            }
            
            // Refresh button
            const refreshBtn = document.getElementById('refreshBtn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', loadInventory);
            }
            
            // Register button
            const registerBtn = document.querySelector('[data-bs-target="#registerModal"]');
            if (registerBtn) {
                registerBtn.addEventListener('click', function() {
                    openModal('registerModal');
                });
            }
        });

        window.addEventListener('DOMContentLoaded', loadDashboard);

        function highlightNav(){
            const hash = location.hash || '#dashboard';
            document.querySelectorAll('.sidebar nav a').forEach(a => {
                if(a.getAttribute('href') === hash){ a.classList.add('active'); }
                else { a.classList.remove('active'); }
            });
        }
        function routeTo(hash){
            const show = (id, visible)=>{
                const el = document.querySelector(id);
                if(!el) return;
                if(visible) el.classList.remove('hidden'); else el.classList.add('hidden');
            };
            // default: dashboard
            const isDash = (hash === '#dashboard');
            show('#dashboard-cards', isDash);
            show('#dashboard-chart', isDash);
            show('#inventory', hash === '#inventory');
            show('#campaigns-section', hash === '#campaigns');
            show('#users', hash === '#users');
        }
        window.addEventListener('hashchange', () => {
            highlightNav();
            routeTo(location.hash || '#dashboard');
        });
    </script>
</head>
<body>
<div class="layout">
    <aside class="sidebar">
        <div class="brand">ü©∏ LifeLine</div>
        <nav>
            <a href="#dashboard">Dashboard</a>
            <a href="#inventory">Inventory</a>
            <a href="#campaigns">Campaigns</a>
            <a href="#users">Staff</a>
            <a href="/">Logout</a>

        </nav>
        <div class="sidebar-footer">v0.1</div>
    </aside>

    <main class="content">
        <div id="dashboard"></div>
        <header class="topbar">
            <h1>Admin Dashboard</h1>
            <div class="topbar-actions">
                <input class="search" placeholder="Search‚Ä¶" />
                <button class="btn ghost">‚ü≥ Refresh</button>
            </div>
        </header>

        <section class="cards" id="dashboard-cards">
            <div class="card metric">
                <div class="icon red">A</div>
                <div class="metric-body">
                    <div class="metric-title">Group A</div>
                    <div class="metric-value" id="kpiA">‚Äî</div>
                </div>
            </div>
            <div class="card metric">
                <div class="icon orange">B</div>
                <div class="metric-body">
                    <div class="metric-title">Group B</div>
                    <div class="metric-value" id="kpiB">‚Äî</div>
                </div>
            </div>
            <div class="card metric">
                <div class="icon purple">AB</div>
                <div class="metric-body">
                    <div class="metric-title">Group AB</div>
                    <div class="metric-value" id="kpiAB">‚Äî</div>
                </div>
            </div>
            <div class="card metric">
                <div class="icon green">O</div>
                <div class="metric-body">
                    <div class="metric-title">Group O</div>
                    <div class="metric-value" id="kpiO">‚Äî</div>
                </div>
            </div>
        </section>

        <section class="panel" id="dashboard-chart">
            <div class="panel-head">
                <h2>Inventory by Blood Type</h2>
            </div>
            <div style="height:260px;padding:12px 14px;">
                <canvas id="invChart"></canvas>
            </div>
        </section>

        <section class="panel hidden" id="inventory">
            <div class="panel-head">
                <h2>Blood Bank Inventory Management</h2>
                <div class="topbar-actions">
                    <input class="search" placeholder="Search..." id="searchInput" />
                    <button class="btn ghost" id="refreshBtn">‚ü≥ Refresh</button>
                    <button class="btn primary" data-bs-toggle="modal" data-bs-target="#registerModal">+ Register New Unit</button>
                </div>
            </div>
            
            <!-- Summary Cards -->
            <div class="cards" style="margin-bottom: 20px;">
                <div class="card metric">
                    <div class="icon red">ü©∏</div>
                    <div class="metric-body">
                        <div class="metric-title">Total Units</div>
                        <div class="metric-value" id="totalUnits">0</div>
                    </div>
                </div>
                <div class="card metric">
                    <div class="icon green">‚úì</div>
                    <div class="metric-body">
                        <div class="metric-title">Available Units</div>
                        <div class="metric-value" id="availableUnits">0</div>
                    </div>
                </div>
                <div class="card metric">
                    <div class="icon orange">üì¶</div>
                    <div class="metric-body">
                        <div class="metric-title">Used Units</div>
                        <div class="metric-value" id="usedUnits">0</div>
                    </div>
                </div>
                <div class="card metric">
                    <div class="icon purple">‚ö†Ô∏è</div>
                    <div class="metric-body">
                        <div class="metric-title">Expired/Removed Units</div>
                        <div class="metric-value" id="expiredUnits">0</div>
                    </div>
                </div>
            </div>

            <!-- Inventory Table -->
            <div class="table-wrap">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Blood Type</th>
                            <th>Quantity (Units)</th>
                            <th>Donation Date</th>
                            <th>Expiry Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryTableBody">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Register New Blood Unit Modal -->
        <div class="modal" id="registerModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 15px; padding: 20px; min-width: 400px;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; margin: -20px -20px 20px -20px; border-radius: 15px 15px 0 0;">
                    <h3 style="margin: 0;">ü©∏ Register a New Blood Unit</h3>
                    <button onclick="closeModal('registerModal')" style="float: right; background: none; border: none; color: white; font-size: 20px; cursor: pointer;">√ó</button>
                </div>
                <form id="registerForm">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Unit ID</label>
                        <input type="text" id="unitId" placeholder="e.g., BU009" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Blood Type</label>
                        <select id="bloodType" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="">Select Blood Type</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Quantity (Units)</label>
                        <input type="number" id="quantity" placeholder="Enter quantity" min="1" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Donation Date</label>
                        <input type="date" id="donationDate" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Expiry Date</label>
                        <input type="date" id="expiryDate" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                </form>
                <div style="text-align: right; margin-top: 20px;">
                    <button onclick="closeModal('registerModal')" class="btn" style="margin-right: 10px;">Cancel</button>
                    <button onclick="recordDonation()" class="btn primary">üíæ Record Donation</button>
                </div>
            </div>
        </div>

        <!-- Edit Blood Unit Modal -->
        <div class="modal" id="editModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 15px; padding: 20px; min-width: 400px;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; margin: -20px -20px 20px -20px; border-radius: 15px 15px 0 0;">
                    <h3 style="margin: 0;">‚úèÔ∏è Adjust Blood Unit</h3>
                    <button onclick="closeModal('editModal')" style="float: right; background: none; border: none; color: white; font-size: 20px; cursor: pointer;">√ó</button>
                </div>
                <form id="editForm">
                    <input type="hidden" id="editUnitId">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Blood Type</label>
                        <select id="editBloodType" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="">Select Blood Type</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Quantity (Units)</label>
                        <input type="number" id="editQuantity" min="1" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Status</label>
                        <select id="editStatus" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="Available">Available</option>
                            <option value="Used">Used</option>
                            <option value="Expired">Expired</option>
                            <option value="Removed">Removed</option>
                            <option value="RESERVED">RESERVED</option>
                        </select>
                    </div>
                </form>
                <div style="text-align: right; margin-top: 20px;">
                    <button onclick="closeModal('editModal')" class="btn" style="margin-right: 10px;">Cancel</button>
                    <button onclick="updateUnit()" class="btn primary">üíæ Update Unit</button>
                </div>
            </div>
        </div>

        <section class="grid-2 hidden" id="campaigns-section">
            <div class="panel" id="campaigns">
                <div class="panel-head">
                    <h2>Campaigns</h2>
                    <form class="inline-form" onsubmit="createCampaign(event)">
                        <input name="title" placeholder="Title" required />
                        <input name="description" placeholder="Description" />
                        <input type="date" name="startDate" />
                        <input type="date" name="endDate" />
                        <label class="switch">
                            <input type="checkbox" name="active" checked />
                            <span>Active</span>
                        </label>
                        <button class="btn primary" type="submit">Create</button>
                    </form>
                </div>
                <div class="table-wrap">
                    <table class="table"><thead><tr><th>Title</th><th>Start</th><th>End</th><th>Active</th></tr></thead><tbody></tbody></table>
                </div>
            </div>
        </section>

        <section class="panel hidden" id="users">
            <div class="panel-head">
                <h2>Staff Members</h2>
                <form id="userForm" class="inline-form" onsubmit="submitUser(event)">
                    <input name="username" placeholder="Username" required />
                    <!-- ‚ùå Removed email field -->
                    <input type="password" name="password" placeholder="Password" />
                    <select name="role">
                        <option value="ROLE_MEDICAL_ADVISER">ROLE_MEDICAL_ADVISER</option>
                        <option value="ROLE_REGISTRATION_OFFICER">ROLE_REGISTRATION_OFFICER</option>
                        <option value="ROLE_IT_SUPPORT_ASSISTANT">ROLE_IT_SUPPORT_ASSISTANT</option>
                        <option value="ROLE_HOSPITAL_COORDINATOR">ROLE_HOSPITAL_COORDINATOR</option>
                        <option value="ROLE_PUBLIC_AWARENESS_MANAGER">ROLE_PUBLIC_AWARENESS_MANAGER</option>
                        <option value="ROLE_SYSTEM_ADMINISTRATOR">ROLE_SYSTEM_ADMINISTRATOR</option>
                        <option value="ROLE_FIELD_OPERATION_SUPERVISOR">ROLE_FIELD_OPERATION_SUPERVISOR</option>
                    </select>

                    <!-- ‚ùå Removed Active switch -->
                    <button class="btn primary" type="submit" data-mode>Create user</button>
                    <button class="btn" type="button"
                            onclick="selectedUserId=null; this.closest('form').reset(); this.previousElementSibling.textContent='Create user'">
                        Clear
                    </button>
                </form>
            </div>
            <div class="table-wrap">
                <table class="table">
                    <thead>
                    <!-- ‚ùå Removed Email and Active columns -->
                    <tr><th>Username</th><th>Role</th><th style="width:120px">Actions</th></tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>

    </main>
</div>

</body>
</html>